## 単体テストの評価軸

以下4つの軸で単体テストケースは評価できる。

- 退行に対する保護
    
    テストをすることで退行及びバグの存在をいかに検知できるかを示す性質。
    
    テストによって実行されるコードが多くなるほど、より多くのバクを見つけ出せるようになる。
    
- リファクタリングへの耐性
    
    偽陽性を生み出すことなく、プロダクションコードに対してリファクタリングを行えるのかをしめす性質。
    
    偽陽性とは、嘘の警告のことで、機能自体には何も問題ないがテストが失敗すること。
    
    これが多発すると、テスト結果を信頼できなくなる。
    
    偽陽性は、テスト対象の内部的なコードと結びつくことで発生しやすい。
    
- 迅速なフィードバック
    
    テストの実施時間がどのくらい短くなるのか
    
- 保守のしやすさ
    
    何をテストしているのかを理解するのがどのくらい難しいのか？
    
    テストケースはサイズが小さいほど読みやすくなる
    
    テストを実施することがどのくらい難しいのか？
    
    テスト時に使われるプロセス外依存が少ないほど実施は簡単になる
    

これらの軸の中で、退行に対する保護、リファクタリングへの耐性、迅速なフィードバックの3つは互いに排反する性質があるため、それぞれの要素を適度に備えるように調整する必要がある。

ただし、リファクタリングへの耐性は、持つか持たないかの2択でしかない。そのため実際は、対抗に対する保護と迅速なフィードバックを調整することになる。

この調整はテストピラミット上でのレイヤーによって異なり、E2Eテストでは退行に対する保護がより重要になり、単体テストでは迅速なフィードバックがより重要になる。

### 観察可能な振る舞いと実装の詳細

リファクタリングへの耐性を考える際に大事なのは、内部的なコードと結びつかないこと。これは実装の詳細に対してテストコードをが書かないこと。

まず、全てのプロダクションコードは

- 公開されている/いない(アクセス修飾子 PublicやPrivate)
- 観察可能な振る舞い/実装の詳細

に分けられる。

観察可能な振る舞いとは

- クライアントが目的を達成するために使う公開された操作
- クライアントが目的を達成するために使う公開された状態

のどちらかであり、それ以外は実装の詳細である。

きちんと設計されたコードは、観察可能な振る舞い＝公開されている、実装の詳細＝公開されていない状態であること。