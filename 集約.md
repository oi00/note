# 集約  
## オブジェクトの操作に関する基本的な原則  
デメテルの法則  
メソッドを呼び出すオブジェクトは、次の４つに限定する
- オブジェクト自身 
- 引数として渡されたオブジェクト
- インスタンス変数
- 直接インスタンス化したオブジェクト

オブジェクトが、他のオブジェクトのフィールドに直接命令をするのではなく、それを保持するオブジェクトが命令を行い、フィールドは保持しているオブジェクト自身が管理すべき  

## 内部データを隠蔽する  
オブジェクトの内部データを非公開にした場合、リポジトリで登録用エンティティに詰め替えを行うときなどに困る。  
そんな場合に役立つのが、通知オブジェクトになる。  
ただし、作成する場合、コードの記述量が大幅に増える。  
```c#:title
public class EFUserRepository : IUserRepository 
{ 
    public void Save( User user) 
    { 
        var userDataModel = new UserDataModel 
        { 
            // ここでUserクラスの情報を公開していないと登録用エンティティに詰め替えられない
            Id = user.Id.Value, 
            Name = user.Name.Value 
        }; 
        context.Users.Add(userDataModel); 
        context.SaveChanges();
    } 
}
```
```c#:title
/// 通知のためのインターフェース
public interface IUserNotification 
{ 
    void Id(UserId id); 
    void Name(UserName name); 
}
```
```c#:title
/// 通知クラス
public class UserDataModelBuilder : IUserNotification 
{ 
    // 通知されたデータはインスタンス変数で保持される 
    private UserId id; 
    private UserName name; 
    public void Id(UserId id)
    { 
        this.id = id; 
    } 
    public void Name(UserName name) 
    { 
        this.name = name; 
    } 
    // 通知されたデータからデータモデルを生成するメソッド 
    public UserDataModel Build() 
    { 
        return new UserDataModel 
        { 
            Id = id.Value, 
            Name = name. Value 
        }; 
    } 
}
```
```c#:title
/// 通知オブジェクトを利用してデータモデルを取得する
public class EFUserRepository : IUserRepository 
{ 
    public void Save(User user) 
    { 
        // 通知オブジェクトを引き渡して内部データを取得 
        var userDataModelBuilder = new UserDataModelBuilder(); 
        user.Notify(userDataModelBuilder); 
        //通知された内部データからデータモデルを生成
        var userDataModel = userDataModelBuilder.Build();
        //データモデルをO/RMapperに引き渡す 
        context.Users.Add(userDataModel);
        context.SaveChanges(); 
    }
}
```