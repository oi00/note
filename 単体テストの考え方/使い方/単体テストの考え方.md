# 単体テストの考え方
## 単体テストの性質
- 古典学派
    - 1単位のふるまいを検証すること
    - 実行時間が短いこと
    - 他のテストケースから隔離されていること
- ロンドン学派
    - 1単位のコードを検証すること
    - 実行時間が短いこと
    - 協力者オブジェクト(テスト対象のオブジェクトが処理の実行に必要な別のオブジェクト)から隔離されていること

ロンドン学派の考え方に基づくと、テストダブルがほとんどのクラスで必要になる。  
それは、必要以上にクラス間の結合度を下げることに繋がり可読性の低下を招く恐れがある。  
また、テストケース数が古典学派と比較して増える傾向にあり、コスパは悪い。  
一方で細かい単位でテストをしているため、各コードの品質はロンドン学派の方が高い。  
しかしそれは、実装の詳細と結びつく可能性が高いことでもあり、テストが使えなくなる可能性も高くなる。

## 単体テストの書き方
### AAA方式
- 準備(Arrange)  
3つの中で1番量が多くなる。  
量が多すぎる場合は、オブジェクトマザーやテストデータパターンで、他ケースと処理を共有、Privateメソッドに切り出す。  
- 実行(Action)  
基本的には処理は1行。1つのふるまいを確認するのに、複数処理が必要なのは設計に問題がある。
- 確認(Assert)  
1単位のふるまいを確認するので、複数項目の確認が必要になっても問題ない。  
ただし、オブジェクトのフィールドの値を全て確認するみたいなことはせず、期待値となるオブジェクトを生成し、それと比較するような方法にする。


## 良い単体テストとは
- 実装の詳細に依存しない  
処理の最終結果を検証する。(≒戻り値)⇒出力値ベーステスト

- 出力値ベーステストを実施するために、テスト対象が純粋な関数であることが望ましい  
純粋な関数：隠れた入出力がない関数  
隠れた入出力：副作用、例外、内外部の状態への参照  
副作用：オブジェクトの状態を変更する、ディスク上のファイルを更新するなど、メソッドシグネチャ(≒ここでは戻り値)には表現されていない出力  
例外：メソッド内で投げられた例外がメソッド内でキャッチされない場合、これもメソッドシグネチャには表現されない出力  
内外部の状態への参照：DBにアクセスしてデータを取得したり、Datetime.Nowのような時間を取得したり、メソッドシグネチャ(≒ここではメソッドの引数)には表現されない入力が存在する

- そのために、関数型アーキテクチャを利用する  
関数型アーキテクチャは、副作用をビジネス・オペレーションの最初や最後に持っていくことで、ビジネスロジックと副作用を分離しやすくしている。
